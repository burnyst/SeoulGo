<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="plandata">
	<!-- parameter, result가 한 개이면  자바의 데이터타입명시
	           여러개이면   VO(DTO), Map으로 처리해야 한다-->
  <!-- sql요소는 다른 구문에서 재사용가능한 SQL 구문을 정의할 때 사용된다. 
  		선언형식<sql id="id값">쿼리문</sql>
  		참조형식 <include refid=”id값”/>
  		    
			예시 <sql id=”userColumns”> id,username,password </sql>
					select <include refid=”userColumns”/>
					from some_table  
  -->	
  <sql id="selectColumns">
		
   		select  PLANNO ,
				PLANDATE ,
				PLANTITLE ,
				PLANCATE ,
				MEMBERID 
	</sql>
<select id="totalCnt" resultType="int">
		select count(*)  from plan 
</select> 	

<select id="plandatat" resultType="pdto">
select * from
	(select ROWNUM RN,a.*
			FROM (SELECT * FROM PLAN 
			ORDER BY PLAN.PLANNO DESC)
			A
			)
	WHERE RN BETWEEN #{start} AND #{end}
</select>
<select id="plandatav" resultType="pdto">
	select  PLANNO ,
			PLANDATE ,
			PLANTITLE ,
			PLANCATE ,
			MEMBERID
				from plan
	
	ORDER BY PLANNO DESC
</select>
<!-- 	 -->
	<!-- 목록조회 -->
<select id="planview" resultType="pdto">
		select PLANNO,
		PLANDATE,
		PLANTITLE,
		PLANCATE,
		MEMBERID FROM plan
		where PLANNO=#{pno}
</select>
	
<select id="addr" parameterType="int" resultType="pdto">
 SELECT ADDR1,ADDR2
			FROM PLACE 
			WHERE place.placeno in(SELECT p1.PLACENO
                                         FROM PLANPLACE P1
                                         WHERE #{addrNo}=P1.PLANNO)
</select>
<select id="addr2" parameterType="int" resultType="pdto">
select addr1, addr2 
	from place
    	where placeNo in (select placeNo from PLANPLACE, plan
        	where #{addrNo}=planplace.planNo)     
</select>
<select id="planSview" parameterType="pdto" resultType="java.util.List">
	    SELECT 
	    	   PLANTITLE,
	    	   PLANCATE,
	    	   ADDR1,
	    	   ADDR2
	    	   MEMBERID FROM plan,PLACE,PLANPLACE
	    	   WHERE PLACE.PLACENO = PLANPLACE.${placeNo}
</select>
<select id="placeview" resultType="pdto">
	select 
		addr1,
		addr2,
		placeNo
		from place
</select>
	<!-- INSERT INTO "SEOULMATE"."PLAN" (PLANNO, PLANDATE, PLANTITLE, PLANCATE, MEMBERID) 
	VALUES ('3', TO_DATE('2020-07-15 12:31:27', 'YYYY-MM-DD HH24:MI:SS'), 'plantitle3', '4', 'test')
	 -->
<insert id="planinsert" parameterType="pdto">
		<selectKey keyProperty="planNo" resultType="int" order="BEFORE">
			select NVL(MAX(planNo),0)+1 from plan
		</selectKey>
		insert into plan (PLANNO,PLANDATE,PLANTITLE,PLANCATE,MEMBERID)
		VALUES(#{planNo},#{planDate},#{planTitle},#{planCate},#{memberid}) 
</insert>
	<insert id="planinsert2" parameterType="pdto">
		insert into PLANPLACE (PLANNO)
		VALUES(#{planNo})
	</insert>
	<!-- 
		INSERT ALL 
		INTO PLAN (PLANNO,PLANDATE,PLANTITLE,PLANCATE,MEMBERID)
		VALUES(#{planNo},#{planDate},#{planTitle},#{planCate},#{memberid})
		INTO PLANPLACE (PLANNO)
		VALUES(#{planNo})
		SELECT PLAN.PLANNO,PLANPLACE.PLANNO,PLANDATE,PLANTITLE,PLANCATE,MEMBERID
		FROM PLAN,PLANPLACE
		-->
	<update id="planupdate" parameterType="pdto">
		update plan
		set PLANDATE=#{planDate},PLANTITLE=#{planTitle},PLANCATE=#{planCate}
		WHERE PLANNO=#{planNo}
	</update>
	<!-- values( #{no}, #{oriName},#{saveName},#{len},#{path} ) -->
	<!-- select   NVL(MAX(bNo),0)+1   from  fileBoard -->
	<!-- 전체게시물 수 조회 -->
	
</mapper>	






